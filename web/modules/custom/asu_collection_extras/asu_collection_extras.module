<?php

/**
 * @file
 * Contains asu_collection_extras.module.
 */

/**
 * This is used by the blocks in this module to get children of a collection.
 *
 * @param mixed $collection_node
 *   Can take a node object or the node ID value.
 * @param bool $sort_by_date
 *   (OPTIONAL) whether or not to sort by date, default is FALSE.
 * @param int $limit
 *   The number of results to return (to provide the recent additions for the
 *   block that only displays only 4 items)
 */
function asu_collection_extras_get_collection_children($collection_node, $sort_by_date = FALSE, $limit = 0, $items_only = TRUE) {
  $collection_nid = (is_object($collection_node) ? $collection_node->id() : $collection_node);
  $childrenQuery = \Drupal::entityQuery('node');
  $orGroup = $childrenQuery
    ->orConditionGroup()
    ->condition('field_member_of', $collection_nid)
    ->condition('field_additional_memberships', $collection_nid);
  $childrenQuery
    ->condition($orGroup)
    ->condition('status', 1);
  if ($items_only) {
    $childrenQuery
      ->condition('type', 'asu_repository_item');
  }
  if ($sort_by_date) {
    $childrenQuery
      ->sort('revision_timestamp', 'DESC');
  }
  if ($limit) {
    $childrenQuery
      ->range(0, $limit);
  }
  return $childrenQuery->execute();
}
