langcode: en
status: true
dependencies:
  enforced:
    module:
      - asu_migrate
id: etd_node
class: null
field_plugin_method: null
cck_plugin_method: null
migration_tags: null
migration_group: migrate_etd_csv
label: 'Import ETD Nodes from CSV'
source:
  plugin: csv
  path: modules/custom/asu_migrate/data/collection_7_items_decoded.csv
  header_row_count: 1
  keys:
    - 'Item ID'
  constants:
    model: 'Digital Document'
    uid: 1
    cid: 'Electronic Thesis and Dissertations'
    pres_state: '558'
    handle: 'https://hdl.handle.net/2286/R.I.'
    in_copyright_tid: '516'
    rights_tid: '568'
process:
  field_extent:
    plugin: skip_on_empty
    source: Extent
    method: process
  field_edtf_date_created:
    plugin: skip_on_empty
    source: 'Date Created'
    method: process
  field_model:
    -
      plugin: str_replace
      source: 'Attachment Count'
      search: 1
      replace: 'Digital Document'
    -
      plugin: str_replace
      search: '/[2-9]/'
      regex: true
      replace: 'Paged Content'
    -
      plugin: entity_lookup
      entity_type: taxonomy_term
      value_key: name
      bundle_key: vid
      bundle: islandora_models
  field_display_hints:
    -
      plugin: str_replace
      source: 'Attachment Count'
      search: 1
      replace: PDFjs
    -
      plugin: entity_lookup
      entity_type: taxonomy_term
      value_key: name
      bundle_key: vid
      bundle: islandora_models
  field_description:
    plugin: skip_on_empty
    source: Description
    method: process
  field_copyright_date:
    plugin: skip_on_empty
    source: 'Date Created'
    method: process
  field_series:
    plugin: skip_on_empty
    source: Series
    method: process
  field_preferred_citation:
    plugin: skip_on_empty
    source: Citation
    method: process
  field_title/target_id:
    -
      plugin: migration
      migration: etd_complex_titles
      no_stub: true
      source: 'Item ID'
    -
      plugin: extract
      index:
        - '0'
  field_title/target_revision_id:
    -
      plugin: migration
      migration: etd_complex_titles
      no_stub: true
      source: 'Item ID'
    -
      plugin: extract
      index:
        - 1
  title: 'Item Title'
  uid: constants/uid
  field_pid: 'Item ID'
  field_preservation_state:
    plugin: entity_lookup
    source: constants/pres_state
    entity_type: taxonomy_term
    bundle_key: vid
    value_key: tid
    bundle: preservation_states
  field_language:
    plugin: entity_lookup
    source: Language
    entity_type: taxonomy_term
    value_key: name
    bundle_key: vid
    bundle: language
  field_handle:
    plugin: concat
    source:
      - constants/handle
      - 'Item ID'
  moderation_state:
    plugin: static_map
    source: Visibility
    map:
      Private: draft
      Public: published
  pseudo_notes:
    plugin: migration_lookup
    migration: etd_notes
    source: 'Item ID'
  field_note_para:
    plugin: sub_process
    source:
      - '@pseudo_notes'
    process:
      target_id: '0'
      target_revision_id: '1'
  field_copyright_statement:
    plugin: entity_lookup
    source: constants/in_copyright_tid
    entity_type: taxonomy_term
    bundle_key: vid
    value_key: tid
    bundle: copyright_statements
  field_reuse_permissions:
    -
      plugin: entity_lookup
      source: constants/rights_tid
      entity_type: taxonomy_term
      bundle_key: vid
      value_key: tid
      bundle: reuse_permissions
  field_member_of:
    source: constants/cid
    plugin: entity_lookup
    entity_type: node
    access_check: 0
    bundle_key: type
    bundle: collection
    value_key: title
  field_subject:
    -
      plugin: skip_on_empty
      source: Subjects
      method: process
    -
      plugin: explode
      delimiter: ' || '
    -
      plugin: entity_lookup
      entity_type: taxonomy_term
      value_key: name
      bundle_key: vid
      bundle: subject
  inst_conts:
    -
      plugin: skip_on_empty
      source: 'Institutional Contributors'
      method: process
    -
      plugin: explode
      delimiter: ' || '
    -
      plugin: str_replace
      search: ' (Publisher)'
      case_insensitive: true
      replace: ''
    -
      plugin: str_to_assoc
      key: name
  linked_agent_pub:
    plugin: sub_process
    source: '@inst_conts'
    process:
      target_id:
        plugin: entity_generate
        source: name
        entity_type: taxonomy_term
        value_key: name
        bundle_key: vid
        bundle: corporate_body
      rel_type:
        plugin: default_value
        default_value: 'relators:pbl'
  aut_conts:
    -
      plugin: skip_on_empty
      source: Authors
      method: process
    -
      plugin: explode
      delimiter: ' || '
    -
      plugin: str_replace
      search: ' (Author)'
      case_insensitive: true
      replace: ''
    -
      plugin: str_to_assoc
      key: name
  linked_agent_aut:
    plugin: sub_process
    source: '@aut_conts'
    process:
      target_id:
        plugin: entity_generate
        source: name
        entity_type: taxonomy_term
        value_key: name
        bundle_key: vid
        bundle: person
      rel_type:
        plugin: default_value
        default_value: 'relators:aut'
  adv_conts:
    -
      plugin: skip_on_empty
      source: Advisors
      method: process
    -
      plugin: explode
      delimiter: ' || '
    -
      plugin: str_replace
      search: '/\s\([a-zA-Z\s]*\)/'
      regex: true
      replace: ''
    -
      plugin: str_to_assoc
      key: name
  linked_agent_adv:
    plugin: sub_process
    source: '@adv_conts'
    process:
      target_id:
        plugin: entity_generate
        source: name
        entity_type: taxonomy_term
        value_key: name
        bundle_key: vid
        bundle: person
      rel_type:
        plugin: default_value
        default_value: 'relators:ths'
  field_linked_agent:
    plugin: merge
    source:
      - '@linked_agent_aut'
      - '@linked_agent_adv'
      - '@linked_agent_pub'
destination:
  plugin: 'entity:node'
  default_bundle: asu_repository_item
migration_dependencies:
  optional:
    - etd_complex_titles
    - etd_notes
